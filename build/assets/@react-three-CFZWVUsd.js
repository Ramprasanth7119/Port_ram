import{r as y,j as B}from"./react-CC2okCHT.js";import{L as de,R as rt,U as ot,a as it,O as st,P as at,S as ct,b as pe,N as lt,A as ut,W as ft,C as dt,B as pt,c as vt,V as mt,d as ie,e as ht,f as gt,T as bt,g as wt,h as yt,D as Q,M as _t}from"./three-CcG_NHIp.js";import{c as xe}from"./debounce-DamGRPQJ.js";import{F as Et,u as St}from"./its-fine-D9oPhAr3.js";import{R as Ct,c as oe}from"./react-reconciler-BdsLuDoV.js";import"./react-dom-BRlYmd6-.js";import"./maath-BHYwKXtb.js";import{_ as Z}from"./@babel-CF3RwP-h.js";import{O as Pt}from"./three-stdlib-F_QJHZuq.js";function bn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Mt(e){let t;const o=new Set,i=(m,n)=>{const r=typeof m=="function"?m(t):m;if(r!==t){const a=t;t=n?r:Object.assign({},t,r),o.forEach(c=>c(t,a))}},p=()=>t,v=(m,n=p,r=Object.is)=>{console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");let a=n(t);function c(){const l=n(t);if(!r(a,l)){const E=a;m(a=l,E)}}return o.add(c),()=>o.delete(c)},d={setState:i,getState:p,subscribe:(m,n,r)=>n||r?v(m,n,r):(o.add(m),()=>o.delete(m)),destroy:()=>o.clear()};return t=e(i,p,d),d}const Rt=typeof window>"u"||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent),je=Rt?y.useEffect:y.useLayoutEffect;function Ot(e){const t=typeof e=="function"?Mt(e):e,o=(i=t.getState,p=Object.is)=>{const[,v]=y.useReducer(w=>w+1,0),b=t.getState(),f=y.useRef(b),d=y.useRef(i),m=y.useRef(p),n=y.useRef(!1),r=y.useRef();r.current===void 0&&(r.current=i(b));let a,c=!1;(f.current!==b||d.current!==i||m.current!==p||n.current)&&(a=i(b),c=!p(r.current,a)),je(()=>{c&&(r.current=a),f.current=b,d.current=i,m.current=p,n.current=!1});const l=y.useRef(b);je(()=>{const w=()=>{try{const u=t.getState(),h=d.current(u);m.current(r.current,h)||(f.current=u,r.current=h,v())}catch{n.current=!0,v()}},s=t.subscribe(w);return t.getState()!==l.current&&w(),s},[]);const E=c?a:r.current;return y.useDebugValue(E),E};return Object.assign(o,t),o[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");const i=[o,t];return{next(){const p=i.length<=0;return{value:i.shift(),done:p}}}},o}var ve={exports:{}},me={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Te;function xt(){return Te||(Te=1,function(e){function t(g,M){var C=g.length;g.push(M);e:for(;0<C;){var O=C-1>>>1,A=g[O];if(0<p(A,M))g[O]=M,g[C]=A,C=O;else break e}}function o(g){return g.length===0?null:g[0]}function i(g){if(g.length===0)return null;var M=g[0],C=g.pop();if(C!==M){g[0]=C;e:for(var O=0,A=g.length,z=A>>>1;O<z;){var F=2*(O+1)-1,q=g[F],G=F+1,ae=g[G];if(0>p(q,C))G<A&&0>p(ae,q)?(g[O]=ae,g[G]=C,O=G):(g[O]=q,g[F]=C,O=F);else if(G<A&&0>p(ae,C))g[O]=ae,g[G]=C,O=G;else break e}}return M}function p(g,M){var C=g.sortIndex-M.sortIndex;return C!==0?C:g.id-M.id}if(typeof performance=="object"&&typeof performance.now=="function"){var v=performance;e.unstable_now=function(){return v.now()}}else{var b=Date,f=b.now();e.unstable_now=function(){return b.now()-f}}var d=[],m=[],n=1,r=null,a=3,c=!1,l=!1,E=!1,w=typeof setTimeout=="function"?setTimeout:null,s=typeof clearTimeout=="function"?clearTimeout:null,u=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function h(g){for(var M=o(m);M!==null;){if(M.callback===null)i(m);else if(M.startTime<=g)i(m),M.sortIndex=M.expirationTime,t(d,M);else break;M=o(m)}}function R(g){if(E=!1,h(g),!l)if(o(d)!==null)l=!0,H(S);else{var M=o(m);M!==null&&U(R,M.startTime-g)}}function S(g,M){l=!1,E&&(E=!1,s(k),k=-1),c=!0;var C=a;try{for(h(M),r=o(d);r!==null&&(!(r.expirationTime>M)||g&&!P());){var O=r.callback;if(typeof O=="function"){r.callback=null,a=r.priorityLevel;var A=O(r.expirationTime<=M);M=e.unstable_now(),typeof A=="function"?r.callback=A:r===o(d)&&i(d),h(M)}else i(d);r=o(d)}if(r!==null)var z=!0;else{var F=o(m);F!==null&&U(R,F.startTime-M),z=!1}return z}finally{r=null,a=C,c=!1}}var _=!1,j=null,k=-1,x=5,T=-1;function P(){return!(e.unstable_now()-T<x)}function L(){if(j!==null){var g=e.unstable_now();T=g;var M=!0;try{M=j(!0,g)}finally{M?I():(_=!1,j=null)}}else _=!1}var I;if(typeof u=="function")I=function(){u(L)};else if(typeof MessageChannel<"u"){var N=new MessageChannel,V=N.port2;N.port1.onmessage=L,I=function(){V.postMessage(null)}}else I=function(){w(L,0)};function H(g){j=g,_||(_=!0,I())}function U(g,M){k=w(function(){g(e.unstable_now())},M)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(g){g.callback=null},e.unstable_continueExecution=function(){l||c||(l=!0,H(S))},e.unstable_forceFrameRate=function(g){0>g||125<g?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):x=0<g?Math.floor(1e3/g):5},e.unstable_getCurrentPriorityLevel=function(){return a},e.unstable_getFirstCallbackNode=function(){return o(d)},e.unstable_next=function(g){switch(a){case 1:case 2:case 3:var M=3;break;default:M=a}var C=a;a=M;try{return g()}finally{a=C}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(g,M){switch(g){case 1:case 2:case 3:case 4:case 5:break;default:g=3}var C=a;a=g;try{return M()}finally{a=C}},e.unstable_scheduleCallback=function(g,M,C){var O=e.unstable_now();switch(typeof C=="object"&&C!==null?(C=C.delay,C=typeof C=="number"&&0<C?O+C:O):C=O,g){case 1:var A=-1;break;case 2:A=250;break;case 5:A=1073741823;break;case 4:A=1e4;break;default:A=5e3}return A=C+A,g={id:n++,callback:M,priorityLevel:g,startTime:C,expirationTime:A,sortIndex:-1},C>O?(g.sortIndex=C,t(m,g),o(d)===null&&g===o(m)&&(E?(s(k),k=-1):E=!0,U(R,C-O))):(g.sortIndex=A,t(d,g),l||c||(l=!0,H(S))),g},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(g){var M=a;return function(){var C=a;a=M;try{return g.apply(this,arguments)}finally{a=C}}}}(me)),me}var ke;function jt(){return ke||(ke=1,ve.exports=xt()),ve.exports}var Le=jt();const Re={},Tt=e=>void Object.assign(Re,e);function kt(e,t){function o(n,{args:r=[],attach:a,...c},l){let E=`${n[0].toUpperCase()}${n.slice(1)}`,w;if(n==="primitive"){if(c.object===void 0)throw new Error("R3F: Primitives without 'object' are invalid!");const s=c.object;w=K(s,{type:n,root:l,attach:a,primitive:!0})}else{const s=Re[E];if(!s)throw new Error(`R3F: ${E} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(r))throw new Error("R3F: The args prop must be an array!");w=K(new s(...r),{type:n,root:l,attach:a,memoizedProps:{args:r}})}return w.__r3f.attach===void 0&&(w.isBufferGeometry?w.__r3f.attach="geometry":w.isMaterial&&(w.__r3f.attach="material")),E!=="inject"&&be(w,c),w}function i(n,r){let a=!1;if(r){var c,l;(c=r.__r3f)!=null&&c.attach?ge(n,r,r.__r3f.attach):r.isObject3D&&n.isObject3D&&(n.add(r),a=!0),a||(l=n.__r3f)==null||l.objects.push(r),r.__r3f||K(r,{}),r.__r3f.parent=n,Me(r),J(r)}}function p(n,r,a){let c=!1;if(r){var l,E;if((l=r.__r3f)!=null&&l.attach)ge(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){r.parent=n,r.dispatchEvent({type:"added"}),n.dispatchEvent({type:"childadded",child:r});const w=n.children.filter(u=>u!==r),s=w.indexOf(a);n.children=[...w.slice(0,s),r,...w.slice(s)],c=!0}c||(E=n.__r3f)==null||E.objects.push(r),r.__r3f||K(r,{}),r.__r3f.parent=n,Me(r),J(r)}}function v(n,r,a=!1){n&&[...n].forEach(c=>b(r,c,a))}function b(n,r,a){if(r){var c,l,E;if(r.__r3f&&(r.__r3f.parent=null),(c=n.__r3f)!=null&&c.objects&&(n.__r3f.objects=n.__r3f.objects.filter(R=>R!==r)),(l=r.__r3f)!=null&&l.attach)Fe(n,r,r.__r3f.attach);else if(r.isObject3D&&n.isObject3D){var w;n.remove(r),(w=r.__r3f)!=null&&w.root&&Bt(ue(r),r)}const u=(E=r.__r3f)==null?void 0:E.primitive,h=!u&&(a===void 0?r.dispose!==null:a);if(!u){var s;v((s=r.__r3f)==null?void 0:s.objects,r,h),v(r.children,r,h)}if(delete r.__r3f,h&&r.dispose&&r.type!=="Scene"){const R=()=>{try{r.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT>"u"?Le.unstable_scheduleCallback(Le.unstable_IdlePriority,R):R()}J(n)}}function f(n,r,a,c){var l;const E=(l=n.__r3f)==null?void 0:l.parent;if(!E)return;const w=o(r,a,n.__r3f.root);if(n.children){for(const s of n.children)s.__r3f&&i(w,s);n.children=n.children.filter(s=>!s.__r3f)}n.__r3f.objects.forEach(s=>i(w,s)),n.__r3f.objects=[],n.__r3f.autoRemovedBeforeAppend||b(E,n),w.parent&&(w.__r3f.autoRemovedBeforeAppend=!0),i(E,w),w.raycast&&w.__r3f.eventCount&&ue(w).getState().internal.interaction.push(w),[c,c.alternate].forEach(s=>{s!==null&&(s.stateNode=w,s.ref&&(typeof s.ref=="function"?s.ref(w):s.ref.current=w))})}const d=()=>{};return{reconciler:Ct({createInstance:o,removeChild:b,appendChild:i,appendInitialChild:i,insertBefore:p,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(n,r)=>{if(!r)return;const a=n.getState().scene;a.__r3f&&(a.__r3f.root=n,i(a,r))},removeChildFromContainer:(n,r)=>{r&&b(n.getState().scene,r)},insertInContainerBefore:(n,r,a)=>{if(!r||!a)return;const c=n.getState().scene;c.__r3f&&p(c,r,a)},getRootHostContext:()=>null,getChildHostContext:n=>n,finalizeInitialChildren(n){var r;return!!((r=n==null?void 0:n.__r3f)!=null?r:{}).handlers},prepareUpdate(n,r,a,c){var l;if(((l=n==null?void 0:n.__r3f)!=null?l:{}).primitive&&c.object&&c.object!==n)return[!0];{const{args:w=[],children:s,...u}=c,{args:h=[],children:R,...S}=a;if(!Array.isArray(w))throw new Error("R3F: the args prop must be an array!");if(w.some((j,k)=>j!==h[k]))return[!0];const _=Ye(n,u,S,!0);return _.changes.length?[!1,_]:null}},commitUpdate(n,[r,a],c,l,E,w){r?f(n,c,E,w):be(n,a)},commitMount(n,r,a,c){var l;const E=(l=n.__r3f)!=null?l:{};n.raycast&&E.handlers&&E.eventCount&&ue(n).getState().internal.interaction.push(n)},getPublicInstance:n=>n,prepareForCommit:()=>null,preparePortalMount:n=>K(n.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(n){var r;const{attach:a,parent:c}=(r=n.__r3f)!=null?r:{};a&&c&&Fe(c,n,a),n.isObject3D&&(n.visible=!1),J(n)},unhideInstance(n,r){var a;const{attach:c,parent:l}=(a=n.__r3f)!=null?a:{};c&&l&&ge(l,n,c),(n.isObject3D&&r.visible==null||r.visible)&&(n.visible=!0),J(n)},createTextInstance:d,hideTextInstance:d,unhideTextInstance:d,getCurrentEventPriority:()=>t(),beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:typeof performance<"u"&&D.fun(performance.now)?performance.now:D.fun(Date.now)?Date.now:()=>0,scheduleTimeout:D.fun(setTimeout)?setTimeout:void 0,cancelTimeout:D.fun(clearTimeout)?clearTimeout:void 0}),applyProps:be}}var Ae,ze;const he=e=>"colorSpace"in e||"outputColorSpace"in e,qe=()=>{var e;return(e=Re.ColorManagement)!=null?e:null},We=e=>e&&e.isOrthographicCamera,Lt=e=>e&&e.hasOwnProperty("current"),se=typeof window<"u"&&((Ae=window.document)!=null&&Ae.createElement||((ze=window.navigator)==null?void 0:ze.product)==="ReactNative")?y.useLayoutEffect:y.useEffect;function Ge(e){const t=y.useRef(e);return se(()=>void(t.current=e),[e]),t}function At({set:e}){return se(()=>(e(new Promise(()=>null)),()=>e(!1)),[e]),null}class $e extends y.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}}$e.getDerivedStateFromError=()=>({error:!0});const Ve="__default",De=new Map,zt=e=>e&&!!e.memoized&&!!e.changes;function Xe(e){var t;const o=typeof window<"u"?(t=window.devicePixelRatio)!=null?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],o),e[1]):e}const te=e=>{var t;return(t=e.__r3f)==null?void 0:t.root.getState()};function ue(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const D={obj:e=>e===Object(e)&&!D.arr(e)&&typeof e!="function",fun:e=>typeof e=="function",str:e=>typeof e=="string",num:e=>typeof e=="number",boo:e=>typeof e=="boolean",und:e=>e===void 0,arr:e=>Array.isArray(e),equ(e,t,{arrays:o="shallow",objects:i="reference",strict:p=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(D.str(e)||D.num(e)||D.boo(e))return e===t;const v=D.obj(e);if(v&&i==="reference")return e===t;const b=D.arr(e);if(b&&o==="reference")return e===t;if((b||v)&&e===t)return!0;let f;for(f in e)if(!(f in t))return!1;if(v&&o==="shallow"&&i==="shallow"){for(f in p?t:e)if(!D.equ(e[f],t[f],{strict:p,objects:"reference"}))return!1}else for(f in p?t:e)if(e[f]!==t[f])return!1;if(D.und(f)){if(b&&e.length===0&&t.length===0||v&&Object.keys(e).length===0&&Object.keys(t).length===0)return!0;if(e!==t)return!1}return!0}};function Dt(e){e.dispose&&e.type!=="Scene"&&e.dispose();for(const t in e)t.dispose==null||t.dispose(),delete e[t]}function K(e,t){const o=e;return o.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function Pe(e,t){let o=e;if(t.includes("-")){const i=t.split("-"),p=i.pop();return o=i.reduce((v,b)=>v[b],e),{target:o,key:p}}else return{target:o,key:t}}const Ie=/-\d+$/;function ge(e,t,o){if(D.str(o)){if(Ie.test(o)){const v=o.replace(Ie,""),{target:b,key:f}=Pe(e,v);Array.isArray(b[f])||(b[f]=[])}const{target:i,key:p}=Pe(e,o);t.__r3f.previousAttach=i[p],i[p]=t}else t.__r3f.previousAttach=o(e,t)}function Fe(e,t,o){var i,p;if(D.str(o)){const{target:v,key:b}=Pe(e,o),f=t.__r3f.previousAttach;f===void 0?delete v[b]:v[b]=f}else(i=t.__r3f)==null||i.previousAttach==null||i.previousAttach(e,t);(p=t.__r3f)==null||delete p.previousAttach}function Ye(e,{children:t,key:o,ref:i,...p},{children:v,key:b,ref:f,...d}={},m=!1){const n=e.__r3f,r=Object.entries(p),a=[];if(m){const l=Object.keys(d);for(let E=0;E<l.length;E++)p.hasOwnProperty(l[E])||r.unshift([l[E],Ve+"remove"])}r.forEach(([l,E])=>{var w;if((w=e.__r3f)!=null&&w.primitive&&l==="object"||D.equ(E,d[l]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(l))return a.push([l,E,!0,[]]);let s=[];l.includes("-")&&(s=l.split("-")),a.push([l,E,!1,s]);for(const u in p){const h=p[u];u.startsWith(`${l}-`)&&a.push([u,h,!1,u.split("-")])}});const c={...p};return n!=null&&n.memoizedProps&&n!=null&&n.memoizedProps.args&&(c.args=n.memoizedProps.args),n!=null&&n.memoizedProps&&n!=null&&n.memoizedProps.attach&&(c.attach=n.memoizedProps.attach),{memoized:c,changes:a}}function be(e,t){var o;const i=e.__r3f,p=i==null?void 0:i.root,v=p==null||p.getState==null?void 0:p.getState(),{memoized:b,changes:f}=zt(t)?t:Ye(e,t),d=i==null?void 0:i.eventCount;e.__r3f&&(e.__r3f.memoizedProps=b);for(let a=0;a<f.length;a++){let[c,l,E,w]=f[a];if(he(e)){const R="srgb",S="srgb-linear";c==="encoding"?(c="colorSpace",l=l===3001?R:S):c==="outputEncoding"&&(c="outputColorSpace",l=l===3001?R:S)}let s=e,u=s[c];if(w.length&&(u=w.reduce((h,R)=>h[R],e),!(u&&u.set))){const[h,...R]=w.reverse();s=R.reverse().reduce((S,_)=>S[_],e),c=h}if(l===Ve+"remove")if(s.constructor){let h=De.get(s.constructor);h||(h=new s.constructor,De.set(s.constructor,h)),l=h[c]}else l=0;if(E&&i)l?i.handlers[c]=l:delete i.handlers[c],i.eventCount=Object.keys(i.handlers).length;else if(u&&u.set&&(u.copy||u instanceof de)){if(Array.isArray(l))u.fromArray?u.fromArray(l):u.set(...l);else if(u.copy&&l&&l.constructor&&u.constructor===l.constructor)u.copy(l);else if(l!==void 0){var m;const h=(m=u)==null?void 0:m.isColor;!h&&u.setScalar?u.setScalar(l):u instanceof de&&l instanceof de?u.mask=l.mask:u.set(l),!qe()&&v&&!v.linear&&h&&u.convertSRGBToLinear()}}else{var n;if(s[c]=l,(n=s[c])!=null&&n.isTexture&&s[c].format===rt&&s[c].type===ot&&v){const h=s[c];he(h)&&he(v.gl)?h.colorSpace=v.gl.outputColorSpace:h.encoding=v.gl.outputEncoding}}J(e)}if(i&&i.parent&&e.raycast&&d!==i.eventCount){const a=ue(e).getState().internal,c=a.interaction.indexOf(e);c>-1&&a.interaction.splice(c,1),i.eventCount&&a.interaction.push(e)}return!(f.length===1&&f[0][0]==="onUpdate")&&f.length&&(o=e.__r3f)!=null&&o.parent&&Me(e),e}function J(e){var t,o;const i=(t=e.__r3f)==null||(o=t.root)==null||o.getState==null?void 0:o.getState();i&&i.internal.frames===0&&i.invalidate()}function Me(e){e.onUpdate==null||e.onUpdate(e)}function It(e,t){e.manual||(We(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function ce(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function Ft(){var e;const t=typeof self<"u"&&self||typeof window<"u"&&window;if(!t)return oe.DefaultEventPriority;switch((e=t.event)==null?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return oe.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return oe.ContinuousEventPriority;default:return oe.DefaultEventPriority}}function Ke(e,t,o,i){const p=o.get(t);p&&(o.delete(t),o.size===0&&(e.delete(i),p.target.releasePointerCapture(i)))}function Bt(e,t){const{internal:o}=e.getState();o.interaction=o.interaction.filter(i=>i!==t),o.initialHits=o.initialHits.filter(i=>i!==t),o.hovered.forEach((i,p)=>{(i.eventObject===t||i.object===t)&&o.hovered.delete(p)}),o.capturedMap.forEach((i,p)=>{Ke(o.capturedMap,t,i,p)})}function Ht(e){function t(d){const{internal:m}=e.getState(),n=d.offsetX-m.initialClick[0],r=d.offsetY-m.initialClick[1];return Math.round(Math.sqrt(n*n+r*r))}function o(d){return d.filter(m=>["Move","Over","Enter","Out","Leave"].some(n=>{var r;return(r=m.__r3f)==null?void 0:r.handlers["onPointer"+n]}))}function i(d,m){const n=e.getState(),r=new Set,a=[],c=m?m(n.internal.interaction):n.internal.interaction;for(let s=0;s<c.length;s++){const u=te(c[s]);u&&(u.raycaster.camera=void 0)}n.previousRoot||n.events.compute==null||n.events.compute(d,n);function l(s){const u=te(s);if(!u||!u.events.enabled||u.raycaster.camera===null)return[];if(u.raycaster.camera===void 0){var h;u.events.compute==null||u.events.compute(d,u,(h=u.previousRoot)==null?void 0:h.getState()),u.raycaster.camera===void 0&&(u.raycaster.camera=null)}return u.raycaster.camera?u.raycaster.intersectObject(s,!0):[]}let E=c.flatMap(l).sort((s,u)=>{const h=te(s.object),R=te(u.object);return!h||!R?s.distance-u.distance:R.events.priority-h.events.priority||s.distance-u.distance}).filter(s=>{const u=ce(s);return r.has(u)?!1:(r.add(u),!0)});n.events.filter&&(E=n.events.filter(E,n));for(const s of E){let u=s.object;for(;u;){var w;(w=u.__r3f)!=null&&w.eventCount&&a.push({...s,eventObject:u}),u=u.parent}}if("pointerId"in d&&n.internal.capturedMap.has(d.pointerId))for(let s of n.internal.capturedMap.get(d.pointerId).values())r.has(ce(s.intersection))||a.push(s.intersection);return a}function p(d,m,n,r){const a=e.getState();if(d.length){const c={stopped:!1};for(const l of d){const E=te(l.object)||a,{raycaster:w,pointer:s,camera:u,internal:h}=E,R=new ie(s.x,s.y,0).unproject(u),S=T=>{var P,L;return(P=(L=h.capturedMap.get(T))==null?void 0:L.has(l.eventObject))!=null?P:!1},_=T=>{const P={intersection:l,target:m.target};h.capturedMap.has(T)?h.capturedMap.get(T).set(l.eventObject,P):h.capturedMap.set(T,new Map([[l.eventObject,P]])),m.target.setPointerCapture(T)},j=T=>{const P=h.capturedMap.get(T);P&&Ke(h.capturedMap,l.eventObject,P,T)};let k={};for(let T in m){let P=m[T];typeof P!="function"&&(k[T]=P)}let x={...l,...k,pointer:s,intersections:d,stopped:c.stopped,delta:n,unprojectedPoint:R,ray:w.ray,camera:u,stopPropagation(){const T="pointerId"in m&&h.capturedMap.get(m.pointerId);if((!T||T.has(l.eventObject))&&(x.stopped=c.stopped=!0,h.hovered.size&&Array.from(h.hovered.values()).find(P=>P.eventObject===l.eventObject))){const P=d.slice(0,d.indexOf(l));v([...P,l])}},target:{hasPointerCapture:S,setPointerCapture:_,releasePointerCapture:j},currentTarget:{hasPointerCapture:S,setPointerCapture:_,releasePointerCapture:j},nativeEvent:m};if(r(x),c.stopped===!0)break}}return d}function v(d){const{internal:m}=e.getState();for(const n of m.hovered.values())if(!d.length||!d.find(r=>r.object===n.object&&r.index===n.index&&r.instanceId===n.instanceId)){const a=n.eventObject.__r3f,c=a==null?void 0:a.handlers;if(m.hovered.delete(ce(n)),a!=null&&a.eventCount){const l={...n,intersections:d};c.onPointerOut==null||c.onPointerOut(l),c.onPointerLeave==null||c.onPointerLeave(l)}}}function b(d,m){for(let n=0;n<m.length;n++){const r=m[n].__r3f;r==null||r.handlers.onPointerMissed==null||r.handlers.onPointerMissed(d)}}function f(d){switch(d){case"onPointerLeave":case"onPointerCancel":return()=>v([]);case"onLostPointerCapture":return m=>{const{internal:n}=e.getState();"pointerId"in m&&n.capturedMap.has(m.pointerId)&&requestAnimationFrame(()=>{n.capturedMap.has(m.pointerId)&&(n.capturedMap.delete(m.pointerId),v([]))})}}return function(n){const{onPointerMissed:r,internal:a}=e.getState();a.lastEvent.current=n;const c=d==="onPointerMove",l=d==="onClick"||d==="onContextMenu"||d==="onDoubleClick",w=i(n,c?o:void 0),s=l?t(n):0;d==="onPointerDown"&&(a.initialClick=[n.offsetX,n.offsetY],a.initialHits=w.map(h=>h.eventObject)),l&&!w.length&&s<=2&&(b(n,a.interaction),r&&r(n)),c&&v(w);function u(h){const R=h.eventObject,S=R.__r3f,_=S==null?void 0:S.handlers;if(S!=null&&S.eventCount)if(c){if(_.onPointerOver||_.onPointerEnter||_.onPointerOut||_.onPointerLeave){const j=ce(h),k=a.hovered.get(j);k?k.stopped&&h.stopPropagation():(a.hovered.set(j,h),_.onPointerOver==null||_.onPointerOver(h),_.onPointerEnter==null||_.onPointerEnter(h))}_.onPointerMove==null||_.onPointerMove(h)}else{const j=_[d];j?(!l||a.initialHits.includes(R))&&(b(n,a.interaction.filter(k=>!a.initialHits.includes(k))),j(h)):l&&a.initialHits.includes(R)&&b(n,a.interaction.filter(k=>!a.initialHits.includes(k)))}}p(w,n,s,u)}}return{handlePointer:f}}const Je=e=>!!(e!=null&&e.render),Qe=y.createContext(null),Nt=(e,t)=>{const o=Ot((f,d)=>{const m=new ie,n=new ie,r=new ie;function a(s=d().camera,u=n,h=d().size){const{width:R,height:S,top:_,left:j}=h,k=R/S;u.isVector3?r.copy(u):r.set(...u);const x=s.getWorldPosition(m).distanceTo(r);if(We(s))return{width:R/s.zoom,height:S/s.zoom,top:_,left:j,factor:1,distance:x,aspect:k};{const T=s.fov*Math.PI/180,P=2*Math.tan(T/2)*x,L=P*(R/S);return{width:L,height:P,top:_,left:j,factor:R/L,distance:x,aspect:k}}}let c;const l=s=>f(u=>({performance:{...u.performance,current:s}})),E=new ht;return{set:f,get:d,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(s=1)=>e(d(),s),advance:(s,u)=>t(s,u,d()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new gt,pointer:E,mouse:E,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const s=d();c&&clearTimeout(c),s.performance.current!==s.performance.min&&l(s.performance.min),c=setTimeout(()=>l(d().performance.max),s.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:a},setEvents:s=>f(u=>({...u,events:{...u.events,...s}})),setSize:(s,u,h,R,S)=>{const _=d().camera,j={width:s,height:u,top:R||0,left:S||0,updateStyle:h};f(k=>({size:j,viewport:{...k.viewport,...a(_,n,j)}}))},setDpr:s=>f(u=>{const h=Xe(s);return{viewport:{...u.viewport,dpr:h,initialDpr:u.viewport.initialDpr||h}}}),setFrameloop:(s="always")=>{const u=d().clock;u.stop(),u.elapsedTime=0,s!=="never"&&(u.start(),u.elapsedTime=0),f(()=>({frameloop:s}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:y.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(s,u,h)=>{const R=d().internal;return R.priority=R.priority+(u>0?1:0),R.subscribers.push({ref:s,priority:u,store:h}),R.subscribers=R.subscribers.sort((S,_)=>S.priority-_.priority),()=>{const S=d().internal;S!=null&&S.subscribers&&(S.priority=S.priority-(u>0?1:0),S.subscribers=S.subscribers.filter(_=>_.ref!==s))}}}}}),i=o.getState();let p=i.size,v=i.viewport.dpr,b=i.camera;return o.subscribe(()=>{const{camera:f,size:d,viewport:m,gl:n,set:r}=o.getState();if(d.width!==p.width||d.height!==p.height||m.dpr!==v){var a;p=d,v=m.dpr,It(f,d),n.setPixelRatio(m.dpr);const c=(a=d.updateStyle)!=null?a:typeof HTMLCanvasElement<"u"&&n.domElement instanceof HTMLCanvasElement;n.setSize(d.width,d.height,c)}f!==b&&(b=f,r(c=>({viewport:{...c.viewport,...c.viewport.getCurrentViewport(f)}})))}),o.subscribe(f=>e(f)),o};let le,Ut=new Set,qt=new Set,Wt=new Set;function we(e,t){if(e.size)for(const{callback:o}of e.values())o(t)}function ne(e,t){switch(e){case"before":return we(Ut,t);case"after":return we(qt,t);case"tail":return we(Wt,t)}}let ye,_e;function Ee(e,t,o){let i=t.clock.getDelta();for(t.frameloop==="never"&&typeof e=="number"&&(i=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),ye=t.internal.subscribers,le=0;le<ye.length;le++)_e=ye[le],_e.ref.current(_e.store.getState(),i,o);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),t.frameloop==="always"?1:t.internal.frames}function Gt(e){let t=!1,o=!1,i,p,v;function b(m){p=requestAnimationFrame(b),t=!0,i=0,ne("before",m),o=!0;for(const r of e.values()){var n;v=r.store.getState(),v.internal.active&&(v.frameloop==="always"||v.internal.frames>0)&&!((n=v.gl.xr)!=null&&n.isPresenting)&&(i+=Ee(m,v))}if(o=!1,ne("after",m),i===0)return ne("tail",m),t=!1,cancelAnimationFrame(p)}function f(m,n=1){var r;if(!m)return e.forEach(a=>f(a.store.getState(),n));(r=m.gl.xr)!=null&&r.isPresenting||!m.internal.active||m.frameloop==="never"||(n>1?m.internal.frames=Math.min(60,m.internal.frames+n):o?m.internal.frames=2:m.internal.frames=1,t||(t=!0,requestAnimationFrame(b)))}function d(m,n=!0,r,a){if(n&&ne("before",m),r)Ee(m,r,a);else for(const c of e.values())Ee(m,c.store.getState());n&&ne("after",m)}return{loop:b,invalidate:f,advance:d}}function Ze(){const e=y.useContext(Qe);if(!e)throw new Error("R3F: Hooks can only be used within the Canvas component!");return e}function W(e=o=>o,t){return Ze()(e,t)}function Oe(e,t=0){const o=Ze(),i=o.getState().internal.subscribe,p=Ge(e);return se(()=>i(p,t,o),[t,i,o]),null}const ee=new Map,{invalidate:Be,advance:He}=Gt(ee),{reconciler:fe,applyProps:X}=kt(ee,Ft),Y={objects:"shallow",strict:!1},$t=(e,t)=>{const o=typeof e=="function"?e(t):e;return Je(o)?o:new ft({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function Vt(e,t){const o=typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement;if(t){const{width:i,height:p,top:v,left:b,updateStyle:f=o}=t;return{width:i,height:p,top:v,left:b,updateStyle:f}}else if(typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:i,height:p,top:v,left:b}=e.parentElement.getBoundingClientRect();return{width:i,height:p,top:v,left:b,updateStyle:o}}else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height,top:0,left:0,updateStyle:o};return{width:0,height:0,top:0,left:0}}function Xt(e){const t=ee.get(e),o=t==null?void 0:t.fiber,i=t==null?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");const p=typeof reportError=="function"?reportError:console.error,v=i||Nt(Be,He),b=o||fe.createContainer(v,oe.ConcurrentRoot,null,!1,null,"",p,null);t||ee.set(e,{fiber:b,store:v});let f,d=!1,m;return{configure(n={}){let{gl:r,size:a,scene:c,events:l,onCreated:E,shadows:w=!1,linear:s=!1,flat:u=!1,legacy:h=!1,orthographic:R=!1,frameloop:S="always",dpr:_=[1,2],performance:j,raycaster:k,camera:x,onPointerMissed:T}=n,P=v.getState(),L=P.gl;P.gl||P.set({gl:L=$t(r,e)});let I=P.raycaster;I||P.set({raycaster:I=new it});const{params:N,...V}=k||{};if(D.equ(V,I,Y)||X(I,{...V}),D.equ(N,I.params,Y)||X(I,{params:{...I.params,...N}}),!P.camera||P.camera===m&&!D.equ(m,x,Y)){m=x;const C=x instanceof dt,O=C?x:R?new st(0,0,0,0,.1,1e3):new at(75,0,.1,1e3);C||(O.position.z=5,x&&(X(O,x),("aspect"in x||"left"in x||"right"in x||"bottom"in x||"top"in x)&&(O.manual=!0,O.updateProjectionMatrix())),!P.camera&&!(x!=null&&x.rotation)&&O.lookAt(0,0,0)),P.set({camera:O}),I.camera=O}if(!P.scene){let C;c!=null&&c.isScene?C=c:(C=new ct,c&&X(C,c)),P.set({scene:K(C)})}if(!P.xr){var H;const C=(z,F)=>{const q=v.getState();q.frameloop!=="never"&&He(z,!0,q,F)},O=()=>{const z=v.getState();z.gl.xr.enabled=z.gl.xr.isPresenting,z.gl.xr.setAnimationLoop(z.gl.xr.isPresenting?C:null),z.gl.xr.isPresenting||Be(z)},A={connect(){const z=v.getState().gl;z.xr.addEventListener("sessionstart",O),z.xr.addEventListener("sessionend",O)},disconnect(){const z=v.getState().gl;z.xr.removeEventListener("sessionstart",O),z.xr.removeEventListener("sessionend",O)}};typeof((H=L.xr)==null?void 0:H.addEventListener)=="function"&&A.connect(),P.set({xr:A})}if(L.shadowMap){const C=L.shadowMap.enabled,O=L.shadowMap.type;if(L.shadowMap.enabled=!!w,D.boo(w))L.shadowMap.type=pe;else if(D.str(w)){var U;const A={basic:pt,percentage:vt,soft:pe,variance:mt};L.shadowMap.type=(U=A[w])!=null?U:pe}else D.obj(w)&&Object.assign(L.shadowMap,w);(C!==L.shadowMap.enabled||O!==L.shadowMap.type)&&(L.shadowMap.needsUpdate=!0)}const g=qe();g&&("enabled"in g?g.enabled=!h:"legacyMode"in g&&(g.legacyMode=h)),d||X(L,{outputEncoding:s?3e3:3001,toneMapping:u?lt:ut}),P.legacy!==h&&P.set(()=>({legacy:h})),P.linear!==s&&P.set(()=>({linear:s})),P.flat!==u&&P.set(()=>({flat:u})),r&&!D.fun(r)&&!Je(r)&&!D.equ(r,L,Y)&&X(L,r),l&&!P.events.handlers&&P.set({events:l(v)});const M=Vt(e,a);return D.equ(M,P.size,Y)||P.setSize(M.width,M.height,M.updateStyle,M.top,M.left),_&&P.viewport.dpr!==Xe(_)&&P.setDpr(_),P.frameloop!==S&&P.setFrameloop(S),P.onPointerMissed||P.set({onPointerMissed:T}),j&&!D.equ(j,P.performance,Y)&&P.set(C=>({performance:{...C.performance,...j}})),f=E,d=!0,this},render(n){return d||this.configure(),fe.updateContainer(B.jsx(Yt,{store:v,children:n,onCreated:f,rootElement:e}),b,null,()=>{}),v},unmount(){et(e)}}}function Yt({store:e,children:t,onCreated:o,rootElement:i}){return se(()=>{const p=e.getState();p.set(v=>({internal:{...v.internal,active:!0}})),o&&o(p),e.getState().events.connected||p.events.connect==null||p.events.connect(i)},[]),B.jsx(Qe.Provider,{value:e,children:t})}function et(e,t){const o=ee.get(e),i=o==null?void 0:o.fiber;if(i){const p=o==null?void 0:o.store.getState();p&&(p.internal.active=!1),fe.updateContainer(null,i,null,()=>{p&&setTimeout(()=>{try{var v,b,f,d;p.events.disconnect==null||p.events.disconnect(),(v=p.gl)==null||(b=v.renderLists)==null||b.dispose==null||b.dispose(),(f=p.gl)==null||f.forceContextLoss==null||f.forceContextLoss(),(d=p.gl)!=null&&d.xr&&p.xr.disconnect(),Dt(p),ee.delete(e)}catch{}},500)})}}fe.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:y.version});const Se={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function Kt(e){const{handlePointer:t}=Ht(e);return{priority:1,enabled:!0,compute(o,i,p){i.pointer.set(o.offsetX/i.size.width*2-1,-(o.offsetY/i.size.height)*2+1),i.raycaster.setFromCamera(i.pointer,i.camera)},connected:void 0,handlers:Object.keys(Se).reduce((o,i)=>({...o,[i]:t(i)}),{}),update:()=>{var o;const{events:i,internal:p}=e.getState();(o=p.lastEvent)!=null&&o.current&&i.handlers&&i.handlers.onPointerMove(p.lastEvent.current)},connect:o=>{var i;const{set:p,events:v}=e.getState();v.disconnect==null||v.disconnect(),p(b=>({events:{...b.events,connected:o}})),Object.entries((i=v.handlers)!=null?i:[]).forEach(([b,f])=>{const[d,m]=Se[b];o.addEventListener(d,f,{passive:m})})},disconnect:()=>{const{set:o,events:i}=e.getState();if(i.connected){var p;Object.entries((p=i.handlers)!=null?p:[]).forEach(([v,b])=>{if(i&&i.connected instanceof HTMLElement){const[f]=Se[v];i.connected.removeEventListener(f,b)}}),o(v=>({events:{...v.events,connected:void 0}}))}}}}function Jt({debounce:e,scroll:t,polyfill:o,offsetSize:i}={debounce:0,scroll:!1,offsetSize:!1}){const p=o||typeof window<"u"&&window.ResizeObserver,[v,b]=y.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0});if(!p)return v.width=1280,v.height=800,[()=>{},v,()=>{}];const f=y.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:v,orientationHandler:null}),d=e?typeof e=="number"?e:e.scroll:null,m=e?typeof e=="number"?e:e.resize:null,n=y.useRef(!1);y.useEffect(()=>(n.current=!0,()=>void(n.current=!1)));const[r,a,c]=y.useMemo(()=>{const s=()=>{if(!f.current.element)return;const{left:u,top:h,width:R,height:S,bottom:_,right:j,x:k,y:x}=f.current.element.getBoundingClientRect(),T={left:u,top:h,width:R,height:S,bottom:_,right:j,x:k,y:x};f.current.element instanceof HTMLElement&&i&&(T.height=f.current.element.offsetHeight,T.width=f.current.element.offsetWidth),Object.freeze(T),n.current&&!tn(f.current.lastBounds,T)&&b(f.current.lastBounds=T)};return[s,m?xe(s,m):s,d?xe(s,d):s]},[b,i,d,m]);function l(){f.current.scrollContainers&&(f.current.scrollContainers.forEach(s=>s.removeEventListener("scroll",c,!0)),f.current.scrollContainers=null),f.current.resizeObserver&&(f.current.resizeObserver.disconnect(),f.current.resizeObserver=null),f.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",f.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",f.current.orientationHandler))}function E(){var s;f.current.element&&(f.current.resizeObserver=new p(a),(s=f.current.resizeObserver)==null||s.observe(f.current.element),t&&f.current.scrollContainers&&f.current.scrollContainers.forEach(u=>u.addEventListener("scroll",c,{capture:!0,passive:!0})),f.current.orientationHandler=()=>{c()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",f.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",f.current.orientationHandler))}const w=s=>{!s||s===f.current.element||(l(),f.current.element=s,f.current.scrollContainers=tt(s),E())};return Zt(c,!!t),Qt(a),y.useEffect(()=>{l(),E()},[t,c,a]),y.useEffect(()=>l,[]),[w,v,r]}function Qt(e){y.useEffect(()=>{const t=e;return window.addEventListener("resize",t),()=>void window.removeEventListener("resize",t)},[e])}function Zt(e,t){y.useEffect(()=>{if(t){const o=e;return window.addEventListener("scroll",o,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",o,!0)}},[e,t])}function tt(e){const t=[];if(!e||e===document.body)return t;const{overflow:o,overflowX:i,overflowY:p}=window.getComputedStyle(e);return[o,i,p].some(v=>v==="auto"||v==="scroll")&&t.push(e),[...t,...tt(e.parentElement)]}const en=["x","y","top","bottom","left","right","width","height"],tn=(e,t)=>en.every(o=>e[o]===t[o]),nn=y.forwardRef(function({children:t,fallback:o,resize:i,style:p,gl:v,events:b=Kt,eventSource:f,eventPrefix:d,shadows:m,linear:n,flat:r,legacy:a,orthographic:c,frameloop:l,dpr:E,performance:w,raycaster:s,camera:u,scene:h,onPointerMissed:R,onCreated:S,..._},j){y.useMemo(()=>Tt(bt),[]);const k=St(),[x,T]=Jt({scroll:!0,debounce:{scroll:50,resize:0},...i}),P=y.useRef(null),L=y.useRef(null);y.useImperativeHandle(j,()=>P.current);const I=Ge(R),[N,V]=y.useState(!1),[H,U]=y.useState(!1);if(N)throw N;if(H)throw H;const g=y.useRef(null);se(()=>{const C=P.current;T.width>0&&T.height>0&&C&&(g.current||(g.current=Xt(C)),g.current.configure({gl:v,events:b,shadows:m,linear:n,flat:r,legacy:a,orthographic:c,frameloop:l,dpr:E,performance:w,raycaster:s,camera:u,scene:h,size:T,onPointerMissed:(...O)=>I.current==null?void 0:I.current(...O),onCreated:O=>{O.events.connect==null||O.events.connect(f?Lt(f)?f.current:f:L.current),d&&O.setEvents({compute:(A,z)=>{const F=A[d+"X"],q=A[d+"Y"];z.pointer.set(F/z.size.width*2-1,-(q/z.size.height)*2+1),z.raycaster.setFromCamera(z.pointer,z.camera)}}),S==null||S(O)}}),g.current.render(B.jsx(k,{children:B.jsx($e,{set:U,children:B.jsx(y.Suspense,{fallback:B.jsx(At,{set:V}),children:t})})})))}),y.useEffect(()=>{const C=P.current;if(C)return()=>et(C)},[]);const M=f?"none":"auto";return B.jsx("div",{ref:L,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:M,...p},..._,children:B.jsx("div",{ref:x,style:{width:"100%",height:"100%"},children:B.jsx("canvas",{ref:P,style:{display:"block"},children:o})})})}),wn=y.forwardRef(function(t,o){return B.jsx(Et,{children:B.jsx(nn,{...t,ref:o})})}),rn=()=>parseInt(wt.replace(/\D+/g,"")),nt=rn(),yn=y.forwardRef(({makeDefault:e,camera:t,regress:o,domElement:i,enableDamping:p=!0,keyEvents:v=!1,onChange:b,onStart:f,onEnd:d,...m},n)=>{const r=W(_=>_.invalidate),a=W(_=>_.camera),c=W(_=>_.gl),l=W(_=>_.events),E=W(_=>_.setEvents),w=W(_=>_.set),s=W(_=>_.get),u=W(_=>_.performance),h=t||a,R=i||l.connected||c.domElement,S=y.useMemo(()=>new Pt(h),[h]);return Oe(()=>{S.enabled&&S.update()},-1),y.useEffect(()=>(v&&S.connect(v===!0?R:v),S.connect(R),()=>void S.dispose()),[v,R,o,S,r]),y.useEffect(()=>{const _=x=>{r(),o&&u.regress(),b&&b(x)},j=x=>{f&&f(x)},k=x=>{d&&d(x)};return S.addEventListener("change",_),S.addEventListener("start",j),S.addEventListener("end",k),()=>{S.removeEventListener("start",j),S.removeEventListener("end",k),S.removeEventListener("change",_)}},[b,f,d,S,r,E]),y.useEffect(()=>{if(e){const _=s().controls;return w({controls:S}),()=>w({controls:_})}},[e,S]),y.createElement("primitive",Z({ref:n,object:S,enableDamping:p},m))}),Ce=nt>=154?"opaque_fragment":"output_fragment";class on extends yt{constructor(t){super(t),this.onBeforeCompile=(o,i)=>{const{isWebGL2:p}=i.capabilities;o.fragmentShader=o.fragmentShader.replace(`#include <${Ce}>`,`
        ${p?`#include <${Ce}>`:`#extension GL_OES_standard_derivatives : enable
#include <${Ce}>`}
      vec2 cxy = 2.0 * gl_PointCoord - 1.0;
      float r = dot(cxy, cxy);
      float delta = fwidth(r);     
      float mask = 1.0 - smoothstep(1.0 - delta, 1.0 + delta, r);
      gl_FragColor = vec4(gl_FragColor.rgb, mask * gl_FragColor.a );
      #include <tonemapping_fragment>
      #include <${nt>=154?"colorspace_fragment":"encodings_fragment"}>
      `)}}}const _n=y.forwardRef((e,t)=>{const[o]=y.useState(()=>new on(null));return y.createElement("primitive",Z({},e,{object:o,ref:t,attach:"material"}))});let $,re;const sn=y.createContext(null),Ne=new _t,Ue=new ie,an=y.forwardRef(({children:e,range:t,limit:o=1e3,...i},p)=>{const v=y.useRef(null);y.useImperativeHandle(p,()=>v.current,[]);const[b,f]=y.useState([]),[[d,m,n]]=y.useState(()=>[new Float32Array(o*3),Float32Array.from({length:o*3},()=>1),Float32Array.from({length:o},()=>1)]);y.useEffect(()=>{v.current.geometry.attributes.position.needsUpdate=!0}),Oe(()=>{for(v.current.updateMatrix(),v.current.updateMatrixWorld(),Ne.copy(v.current.matrixWorld).invert(),v.current.geometry.drawRange.count=Math.min(o,t!==void 0?t:o,b.length),$=0;$<b.length;$++)re=b[$].current,re.getWorldPosition(Ue).applyMatrix4(Ne),Ue.toArray(d,$*3),v.current.geometry.attributes.position.needsUpdate=!0,re.matrixWorldNeedsUpdate=!0,re.color.toArray(m,$*3),v.current.geometry.attributes.color.needsUpdate=!0,n.set([re.size],$),v.current.geometry.attributes.size.needsUpdate=!0});const r=y.useMemo(()=>({getParent:()=>v,subscribe:a=>(f(c=>[...c,a]),()=>f(c=>c.filter(l=>l.current!==a.current)))}),[]);return y.createElement("points",Z({userData:{instances:b},matrixAutoUpdate:!1,ref:v,raycast:()=>null},i),y.createElement("bufferGeometry",null,y.createElement("bufferAttribute",{attach:"attributes-position",count:d.length/3,array:d,itemSize:3,usage:Q}),y.createElement("bufferAttribute",{attach:"attributes-color",count:m.length/3,array:m,itemSize:3,usage:Q}),y.createElement("bufferAttribute",{attach:"attributes-size",count:n.length,array:n,itemSize:1,usage:Q})),y.createElement(sn.Provider,{value:r},e))}),cn=y.forwardRef(({children:e,positions:t,colors:o,sizes:i,stride:p=3,...v},b)=>{const f=y.useRef(null);return y.useImperativeHandle(b,()=>f.current,[]),Oe(()=>{const d=f.current.geometry.attributes;d.position.needsUpdate=!0,o&&(d.color.needsUpdate=!0),i&&(d.size.needsUpdate=!0)}),y.createElement("points",Z({ref:f},v),y.createElement("bufferGeometry",null,y.createElement("bufferAttribute",{attach:"attributes-position",count:t.length/p,array:t,itemSize:p,usage:Q}),o&&y.createElement("bufferAttribute",{attach:"attributes-color",count:o.length/p,array:o,itemSize:3,usage:Q}),i&&y.createElement("bufferAttribute",{attach:"attributes-size",count:i.length/p,array:i,itemSize:1,usage:Q})),e)}),En=y.forwardRef((e,t)=>e.positions instanceof Float32Array?y.createElement(cn,Z({},e,{ref:t})):y.createElement(an,Z({},e,{ref:t})));export{wn as C,yn as O,En as P,_n as a,bn as g,Oe as u};
